{% extends 'single_pages/layout.html' %}
{% block content %}

    {% load static %}
    <title>My_page</title>


    <main id="main">

        <!-- ======= Breadcrumbs ======= -->
        <div class="breadcrumbs">
            <div class="page-header d-flex align-items-center">
                <div class="container position-relative">
                    <div class="row d-flex justify-content-center">
                        <div class="col-lg-6 text-center">
                            <h2>message</h2>
                            <p>마이페이지</p>
                        </div>
                    </div>
                </div>
            </div>
            <nav>
                <div class="container">
                    <ol>
                        <li><a href="{% url 'my_page' %}">my_page</a></li>
                        <li>message</li>
                    </ol>
                </div>
            </nav>
        </div><!-- End Breadcrumbs -->

        <section id="messaging" class="messaging">
            <div class="container" data-aos="fade-up">
                {# 쪽지보내기 버튼 #}
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <div class="pricing pricing-item">
                        <a href="{% url 'new_message' %}" class="buy-btn">쪽지보내기</a>
                    </div>
                </div>


            <div class="row gy-4 posts-list">
                <div class="sidebar">
                    <div class="sidebar-item categories">
                    <h3 class="sidebar-title">Categories</h3>
                    <ul class="mt-3">
                        {% for category in categories %} <!-- 카테고리 목록으로 보여주는 곳 -->
                            <li>
                                <a href="{{ category.get_absolute_url }}">{{ category }} ({{ category.bookstore_set.count }})</a>
                            </li>
                        {% endfor %}
                    </ul>
                  </div><!-- End sidebar categories-->
            </div>

                <p>로드중입니다...</p>
                <hr/>
                {% regroup all_messages|dictsort:'timestamp' by user as all_messages_group %}

                {% for user in users %}
                    <div class="row gy-4 posts-list">
                        <div class="sidebar">
                            <div class="sidebar-item categories">
                                <h3 class="sidebar-title">{{ user }}</h3>
                                <li>
                                    <a href="{{ user.get_absolute_url }}">{{ category }}
                                        ({{ category.bookstore_set.count }})</a>
                                </li>
{#                                <p><strong>{{ user }}</strong></p>#}
                                {% for group in all_messages_group %}
                                    {% for message in group.list %}
                                        {% if not user == message.receiver and not user == message.sender %}
                                        {% else %}
                                            <p>{{ message.content }}</p>
                                            <p>{{ message.timestamp }}</p>
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endfor %}

                {#                {% regroup all_messages|dictsort:'timestamp' by user as all_messages_group %}#}
                {#                {% for group in all_messages_group %}#}
                {#                    {% for message in group.list %}#}
                {#                        <p>{{ message.content }}</p>#}
                {#                        <p>{{ message.timestamp }}</p>#}
                {#                    {% endfor %}#}
                {#                {% endfor %}#}

            </div>
        </section>
    </main>

{% endblock %}